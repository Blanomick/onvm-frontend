{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{useNavigate}from'react-router-dom';// Import pour la navigation\nimport axios from'axios';import{useParams}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const apiUrl=process.env.REACT_APP_API_URL;console.log(\"API URL utilisée :\",apiUrl);function CreateCommunity(_ref){let{userId}=_ref;const{communityId}=useParams();const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[name,setName]=useState('');const[description,setDescription]=useState('');const[communities,setCommunities]=useState([]);const navigate=useNavigate();// Hook pour la navigation\n// Ajoutez fetchMessages ici, après les useState\nconst fetchMessages=useCallback(()=>{axios.get(`/api/communities/${communityId}/messages`).then(response=>setMessages(response.data)).catch(error=>console.error('Erreur lors de la récupération des messages:',error));},[communityId]);// Fonction pour récupérer les communautés\nconst fetchCommunities=useCallback(async()=>{try{const response=await axios.get(`${process.env.REACT_APP_API_URL}/api/communities/users/${userId}`);setCommunities(response.data);}catch(error){console.error('Erreur lors de la récupération des communautés:',error);}},[userId]);// Fonction pour envoyer un message\nconst handleSendMessage=async()=>{if(newMessage.trim()==='')return;try{const response=await axios.post(`${process.env.REACT_APP_API_URL}/api/communities/${communityId}/messages`,{content:newMessage,user_id:userId});setMessages(prevMessages=>[...prevMessages,response.data]);setNewMessage('');// Réinitialise le champ de message\n}catch(error){console.error(\"Erreur lors de l'envoi du message :\",error);}};useEffect(()=>{if(userId){fetchCommunities();}if(communityId){fetchMessages();}},[userId,communityId,fetchCommunities,fetchMessages]);// Ajoute toutes les dépendances nécessaires\n// Fonction pour créer une nouvelle communauté\nconst handleCreateCommunity=async e=>{e.preventDefault();if(!name||!description){alert('Tous les champs sont requis.');return;}try{await axios.post(`${process.env.REACT_APP_API_URL}/api/communities`,{name,description,created_by:userId});setName('');setDescription('');fetchCommunities();// Rafraîchir la liste des communautés\n}catch(error){console.error('Erreur lors de la création de la communauté:',error);}};// Fonction pour rediriger vers la page de conversation de la communauté\nconst goToCommunityConversation=communityId=>{navigate(`/community/${communityId}`);// Redirige vers la page de la communauté\n};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Cr\\xE9er une nouvelle communaut\\xE9\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleCreateCommunity,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Nom de la communaut\\xE9 :\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:name,onChange:e=>setName(e.target.value),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Description :\"}),/*#__PURE__*/_jsx(\"textarea\",{value:description,onChange:e=>setDescription(e.target.value),required:true})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Cr\\xE9er\"})]}),/*#__PURE__*/_jsx(\"h3\",{children:\"Vos Communaut\\xE9s :\"}),/*#__PURE__*/_jsx(\"ul\",{children:communities.length>0?communities.map(community=>/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"h4\",{onClick:()=>goToCommunityConversation(community.id),style:{cursor:'pointer',color:'blue',textDecoration:'underline'},children:community.name}),/*#__PURE__*/_jsx(\"p\",{children:community.description})]},community.id)):/*#__PURE__*/_jsx(\"p\",{children:\"Vous n'avez pas encore cr\\xE9\\xE9 de communaut\\xE9.\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Discussions :\"}),/*#__PURE__*/_jsx(\"div\",{className:\"messages\",children:messages.length>0?messages.map((message,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"message\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[message.username,\":\"]}),\" \",message.content]},index)):/*#__PURE__*/_jsx(\"p\",{children:\"Aucun message pour le moment.\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"new-message\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\xC9crire un message...\",value:newMessage,onChange:e=>setNewMessage(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSendMessage,children:\"Envoyer\"})]})]});}export default CreateCommunity;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useNavigate","axios","useParams","jsx","_jsx","jsxs","_jsxs","apiUrl","process","env","REACT_APP_API_URL","console","log","CreateCommunity","_ref","userId","communityId","messages","setMessages","newMessage","setNewMessage","name","setName","description","setDescription","communities","setCommunities","navigate","fetchMessages","get","then","response","data","catch","error","fetchCommunities","handleSendMessage","trim","post","content","user_id","prevMessages","handleCreateCommunity","e","preventDefault","alert","created_by","goToCommunityConversation","children","onSubmit","type","value","onChange","target","required","length","map","community","onClick","id","style","cursor","color","textDecoration","className","message","index","username","placeholder"],"sources":["C:/Users/mambo/Downloads/ONVM/frontend/src/components/CreateCommunity.js"],"sourcesContent":["import React, { useState, useEffect , useCallback  } from 'react';\r\nimport { useNavigate } from 'react-router-dom'; // Import pour la navigation\r\nimport axios from 'axios';\r\nimport { useParams } from 'react-router-dom';\r\n\r\n\r\nconst apiUrl = process.env.REACT_APP_API_URL;\r\n\r\nconsole.log(\"API URL utilisée :\", apiUrl);\r\n\r\nfunction CreateCommunity({ userId }) {\r\n  const { communityId } = useParams();\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [name, setName] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [communities, setCommunities] = useState([]);\r\n  const navigate = useNavigate(); // Hook pour la navigation\r\n\r\n // Ajoutez fetchMessages ici, après les useState\r\n const fetchMessages = useCallback(() => {\r\n  axios.get(`/api/communities/${communityId}/messages`)\r\n    .then((response) => setMessages(response.data))\r\n    .catch((error) => console.error('Erreur lors de la récupération des messages:', error));\r\n}, [communityId]);\r\n\r\n\r\n// Fonction pour récupérer les communautés\r\nconst fetchCommunities = useCallback(async () => {\r\n  try {\r\n    const response = await axios.get(`${process.env.REACT_APP_API_URL}/api/communities/users/${userId}`);\r\n    setCommunities(response.data);\r\n  } catch (error) {\r\n    console.error('Erreur lors de la récupération des communautés:', error);\r\n  }\r\n}, [userId]);\r\n\r\n // Fonction pour envoyer un message\r\n const handleSendMessage = async () => {\r\n  if (newMessage.trim() === '') return;\r\n\r\n  try {\r\n    const response = await axios.post(`${process.env.REACT_APP_API_URL}/api/communities/${communityId}/messages`, {\r\n      content: newMessage,\r\n      user_id: userId,\r\n    });\r\n    setMessages((prevMessages) => [...prevMessages, response.data]);\r\n    setNewMessage(''); // Réinitialise le champ de message\r\n  } catch (error) {\r\n    console.error(\"Erreur lors de l'envoi du message :\", error);\r\n  }\r\n};\r\n\r\n\r\n  useEffect(() => {\r\n    if (userId) {\r\n      fetchCommunities();\r\n    }\r\n    if (communityId) {\r\n      fetchMessages();\r\n    }\r\n  }, [userId, communityId, fetchCommunities, fetchMessages]); // Ajoute toutes les dépendances nécessaires\r\n\r\n  \r\n\r\n  // Fonction pour créer une nouvelle communauté\r\n  const handleCreateCommunity = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!name || !description) {\r\n      alert('Tous les champs sont requis.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await axios.post(`${process.env.REACT_APP_API_URL}/api/communities`, {\r\n        name,\r\n        description,\r\n        created_by: userId,\r\n      });\r\n      setName('');\r\n      setDescription('');\r\n      fetchCommunities(); // Rafraîchir la liste des communautés\r\n    } catch (error) {\r\n      console.error('Erreur lors de la création de la communauté:', error);\r\n    }\r\n  };\r\n\r\n  // Fonction pour rediriger vers la page de conversation de la communauté\r\n  const goToCommunityConversation = (communityId) => {\r\n    navigate(`/community/${communityId}`); // Redirige vers la page de la communauté\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h2>Créer une nouvelle communauté</h2>\r\n      <form onSubmit={handleCreateCommunity}>\r\n        <div>\r\n          <label>Nom de la communauté :</label>\r\n          <input\r\n            type=\"text\"\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            required\r\n          />\r\n        </div>\r\n        <div>\r\n          <label>Description :</label>\r\n          <textarea\r\n            value={description}\r\n            onChange={(e) => setDescription(e.target.value)}\r\n            required\r\n          />\r\n        </div>\r\n        <button type=\"submit\">Créer</button>\r\n      </form>\r\n\r\n      <h3>Vos Communautés :</h3>\r\n      <ul>\r\n        {communities.length > 0 ? (\r\n          communities.map((community) => (\r\n            <li key={community.id}>\r\n              <h4 onClick={() => goToCommunityConversation(community.id)} style={{ cursor: 'pointer', color: 'blue', textDecoration: 'underline' }}>\r\n                {community.name}\r\n              </h4>\r\n              <p>{community.description}</p>\r\n            </li>\r\n          ))\r\n        ) : (\r\n          <p>Vous n'avez pas encore créé de communauté.</p>\r\n        )}\r\n      </ul>\r\n\r\n\r\n      <h3>Discussions :</h3>\r\n      <div className=\"messages\">\r\n        {messages.length > 0 ? (\r\n          messages.map((message, index) => (\r\n            <div key={index} className=\"message\">\r\n              <strong>{message.username}:</strong> {message.content}\r\n            </div>\r\n          ))\r\n        ) : (\r\n          <p>Aucun message pour le moment.</p>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"new-message\">\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Écrire un message...\"\r\n          value={newMessage}\r\n          onChange={(e) => setNewMessage(e.target.value)}\r\n        />\r\n        <button onClick={handleSendMessage}>Envoyer</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n  \r\n  \r\n\r\n\r\nexport default CreateCommunity;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}